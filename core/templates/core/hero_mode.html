<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>VocabHero: Hero Mode 2.0</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
:root {
  --bg1:#ffeaf5; --bg2:#fbe5ff; --bg3:#e7f7ff; --bg4:#fff0f7;
  --accent1:#ffa3d1; --accent2:#d09eff; --accent3:#f8b8ff;
  --muted:#6b5b7b; --radius:20px;
}

body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  z-index: -1;
  background: linear-gradient(-45deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
  background-size: 400% 400%;
  animation: dreamyBG 22s ease infinite;
}

html, body {
  height: 100%;
  margin: 0;
  font-family: 'Quicksand', sans-serif;
  color: #4a3b4e;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  overflow: hidden;
}
@keyframes dreamyBG {
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

.hero-wrap {
  width:min(1100px,95vw);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding-block: 12px;
}

.panel {
  flex:1;
  background:linear-gradient(
    to bottom right,
    rgba(255,255,255,0.75),
    rgba(255,255,255,0.55)
  );
  backdrop-filter:blur(18px) saturate(160%);
  border-radius:var(--radius);
  padding:36px;
  min-height:85vh; 
  box-shadow:0 5px 5px rgba(50,40,70,.1);
  display:flex;
  flex-direction:column;
  align-items:stretch;
  animation:fadeIn .8s ease;
  position:relative;
}
@keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:none;} }

.header {
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  margin-bottom:28px;
}
.header h1 {
  font-size:2.35rem;margin:0;
  background:linear-gradient(to right,var(--accent1),var(--accent2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  text-shadow:0 2px 6px rgba(0,0,0,.1);
}
.meta {
  position:absolute;
  left:0;
  top:50%;
  transform:translateY(-50%);
  display:flex;
  gap:12px;
  align-items:center;
  color:var(--muted);
  font-weight:600;
  font-size:1rem;
}

.timer-circle {
  position:absolute; top:20px; right:20px;
  width:110px;height:110px;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  background:conic-gradient(var(--accent1) 0deg,var(--accent2) 0deg);
  box-shadow:0 6px 16px rgba(130,70,160,.15);
  z-index:10;
}
.timer-inner {
  width:78%;height:78%;border-radius:50%;
  background:rgba(255,255,255,.85);backdrop-filter:blur(6px);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-weight:700;color:var(--accent2);font-size:1.05rem;
  box-shadow:inset 0 3px 8px rgba(0,0,0,.05)
}

.xp-bar-wrap {
  width:100%;height:24px;
  background:rgba(0,0,0,.06);
  border-radius:999px;
  overflow:hidden;
  margin-top:70px;
}
.xp-bar {
  height:100%;width:0%;
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  transition:width .5s ease;
}
.xp-info {display:flex;justify-content:space-between;font-size:1.05rem;color:var(--muted);margin-top:8px}

.word-card {
  margin-top:42px;
  border-radius:18px;padding:26px;
  background:rgba(255,255,255,.85);backdrop-filter:blur(10px);
  text-align:center;font-size:1.8rem;font-weight:700;color:#2b2530;
  box-shadow:0 8px 18px rgba(0,0,0,.08);
  min-height:120px;
  display:flex;align-items:center;justify-content:center;
}

.input-row {display:flex;gap:12px;margin-top:26px}
.input-row input {
  flex:1;padding:16px 16px;border-radius:16px;
  border:1px solid rgba(0,0,0,.05);
  font-size:1.05rem;box-shadow:inset 0 2px 6px rgba(0,0,0,.05);
  min-height:50px;
}
.input-row button {
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  color:#fff;border:none;padding:14px 18px;border-radius:16px;font-weight:700;cursor:pointer;
  transition:transform .2s ease, filter .2s ease;
  box-shadow:0 6px 16px rgba(0,0,0,.1);
  min-height:50px;
}
.input-row button:hover {transform:translateY(-2px) scale(1.04);filter:brightness(1.08)}

#feedback {margin-top:18px;min-height:26px;font-weight:700;color:var(--muted);text-shadow:0 1px 2px rgba(255,255,255,.7)}

.back-link {
  display:block;
  margin-top:16px;
  text-align:center;
  text-decoration:none;
  font-weight:bold;
  font-size:1.05em;
  color:#c678dd;
  transition:color 0.2s ease;
}
.back-link:hover {color:#a347a0}

.hidden{display:none}

/* ===== Modal Game Over & Item Modal ===== */
#gameOverModal,
#itemModal,
#levelCompleteModal,
#nextLevelModal{
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,.55); z-index:999;
}
#gameOverModal.hidden, #itemModal.hidden, #levelCompleteModal.hidden, #nextLevelModal.hidden {display:none}

.modal-card{
  width:min(560px,92vw);
  background:linear-gradient(to bottom right,rgba(255,255,255,.95),rgba(255,255,255,.85));
  border-radius:22px; padding:28px; box-shadow:0 12px 32px rgba(0,0,0,.25);
  text-align:center; backdrop-filter:blur(10px); 
}
.modal-title{
  margin:0 0 6px 0; font-size:1.6rem;
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.modal-stats{color:#584a64; font-weight:600; line-height:1.6}
.modal-stats b{color:#2b2530}
.modal-actions{margin-top:18px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap}
.modal-actions button, .modal-actions a{
  border:none; cursor:pointer; font-weight:800; padding:12px 16px; border-radius:14px; text-decoration:none;
  background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#fff; box-shadow:0 6px 16px rgba(0,0,0,.12);
}
.modal-actions button:hover, .modal-actions a:hover{filter:brightness(1.08); transform:translateY(-1px)}

/* Item cards */
.item-grid{
  display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-top:16px;
}
.item-card{
  display:flex; flex-direction:column; gap:8px; align-items:flex-start;
  padding:16px; border-radius:18px;
  background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.85));
  box-shadow:0 6px 16px rgba(0,0,0,.12);
  text-align:left;
}
.item-card h4{
  margin:0; font-size:1.05rem;
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.item-card p{margin:0; color:#5c4f68; font-weight:600; line-height:1.4}
.item-card button{
  margin-top:8px; align-self:stretch;
  padding:10px 14px; border:none; border-radius:12px; cursor:pointer; font-weight:800;
  background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#fff;
  transition:transform .15s ease, filter .15s ease;
}
.item-card button:hover{transform:translateY(-2px); filter:brightness(1.08)}
  </style>
</head>
<body>
  <div class="hero-wrap">
    <div class="panel">
      <!-- Header -->
      <div class="header">
        <div class="meta">
          <div>Level: <strong id="level">1</strong></div>
          <div id="lives">üíóüíóüíó</div>
        </div>
        <h1>üå∏ VOCAB HERO</h1>
      </div>

      <!-- Timer -->
      <div class="timer-circle" id="timerCircle">
        <div class="timer-inner">
          <div id="timerNumber">50</div>
        </div>
      </div>

      <!-- XP Bar -->
      <div class="xp-bar-wrap">
        <div class="xp-bar" id="xpBar"></div>
      </div>
      <div class="xp-info">
        <div>XP: <span id="xp">0</span></div>
        <div>/ <span id="xpTarget">100</span></div>
      </div>

      <div class="word-card" id="wordDisplay">Naƒç√≠t√°n√≠...</div>
      <div class="input-row">
        <input id="answerInput" type="text" placeholder="Zadej ƒçesk√Ω p≈ôeklad" autocomplete="off" />
        <button id="answerBtn" onclick="submitAnswer()">Odpovƒõdƒõt</button>
      </div>
      <div id="feedback"></div>

      <div style="margin-top:auto; text-align:center; color:var(--muted); font-size:0.95rem;">
        XP c√≠l: <span id="xpGoalSmall">100</span><br>
        Mini event ≈°ance: <span id="miniChance">12%</span>
      </div>

      <a href="{% url 'home' %}" class="back-link">‚Üê Zpƒõt na √∫vodn√≠ str√°nku</a>
    </div>
  </div>

  <!-- ===== Modal (Game Over) ===== -->
  <div id="gameOverModal" class="hidden">
    <div class="modal-card">
      <h2 id="gameOverTitle" class="modal-title">Konec hry!</h2>
      <div id="gameOverStats" class="modal-stats"></div>
      <div class="modal-actions">
        <button onclick="restartGame()">Hr√°t znovu</button>
        <button onclick="closeModal()">Z≈Østat</button>
      </div>
    </div>
  </div>

  <!-- ===== Modal (Level Complete) ===== -->
  <div id="levelCompleteModal" class="hidden">
    <div class="modal-card">
      <h2 class="modal-title">‚≠ê Level Complete!</h2>
      <div class="modal-stats">
        Gratuluji! Dokonƒçil jsi Level <b id="completeLevelNum">1</b> üéâ
      </div>
      <div class="modal-actions">
        <button onclick="continueToItemSelection()">Pokraƒçovat</button>
      </div>
    </div>
  </div>

  <!-- ===== Modal (Item Choice) ===== -->
  <div id="itemModal" class="hidden">
    <div class="modal-card">
      <h2 class="modal-title">üéÅ Vyber si odmƒõnu!</h2>
      <div id="itemGrid" class="item-grid"></div>
    </div>
  </div>

  <!-- ===== Modal (Next Level Start) ===== -->
  <div id="nextLevelModal" class="hidden">
    <div class="modal-card">
      <h2 class="modal-title">‚öîÔ∏è Level <span id="nextLevelNum">2</span> zaƒç√≠n√°!</h2>
      <div class="modal-stats">
        P≈ôiprav se ‚Äî nov√Ω level zaƒçne hned po stisku Start!
      </div>
      <div class="modal-actions">
        <button onclick="startNextLevel()">Start!</button>
      </div>
    </div>
  </div>

<script>
/* ==== DATA & STATE ==== */
const wordPools = {{ level_data|safe }};
let currentLevel = 1;
let xp = 0;
let totalXP = 0;       
let xpBonus = 0;
let miniEventBonus = 0;
let glassCannon = false;
let temporalContract = false;
let phoenixFeather = false;
let adrenalineRush = false;
let timeWarp = false;
let phoenixUsed = false;
let timeWarpReady = false;
let pickedItems = [];
let doubleXPActive = false;
let lives = 3;
let timer = 50;
let interval = null;
let currentWord = null;
let usedWords = [];
let words = [];
let isGameOver = false;
let correctCount = 0;
let wrongCount = 0;

const xpPerCorrect = 8;
const adrenalineBonus = 3;
const levelXPGoals = { 1: 100, 2: 130, 3: 150, 4: 180, 5: 210, 6: 230, 7: 250 };
const baseTimes   = { 1: 50, 2: 45, 3: 45, 4: 40, 5: 38, 6: 35, 7: 32 };

/* ==== DOM ==== */
const xpDisplay = document.getElementById("xp");
const xpTargetDisplay = document.getElementById("xpTarget");
const xpGoalSmall = document.getElementById("xpGoalSmall");
const xpBar = document.getElementById("xpBar");
const levelDisplay = document.getElementById("level");
const livesDisplay = document.getElementById("lives");
const timerCircle = document.getElementById("timerCircle");
const timerNumber = document.getElementById("timerNumber");
const wordDisplay = document.getElementById("wordDisplay");
const answerInput = document.getElementById("answerInput");
const feedback = document.getElementById("feedback");
const miniChanceDisplay = document.getElementById("miniChance");
const itemModal = document.getElementById("itemModal");
const itemGrid = document.getElementById("itemGrid");

/* ==== INPUT (Enter) ‚Äì blokujeme p≈ôi otev≈ôen√©m item modalu ==== */
document.addEventListener('keydown', (e) => {
  const itemOpen = !itemModal.classList.contains('hidden');
  const anyModalOpen = !document.getElementById("levelCompleteModal").classList.contains('hidden')
                       || !document.getElementById("nextLevelModal").classList.contains('hidden')
                       || itemOpen
                       || !document.getElementById("gameOverModal").classList.contains('hidden');
  if (e.key === 'Enter' && !answerInput.disabled && !anyModalOpen) {
    submitAnswer();
  }
});

/* ==== UTILS ==== */
function clampTimer() { if (timer < 0) timer = 0; }
function addTime(delta) { timer += delta; clampTimer(); }

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}
function pickRandom(array, ratio) {
  let count = Math.floor(array.length * ratio);
  let copy = [...array];
  shuffle(copy);
  return copy.slice(0, count);
}

/* ==== WORDS ==== */
function getFilteredWords() {
  let pool = [];
  if (wordPools && wordPools.easy) {
    if (currentLevel === 1) pool = pool.concat(wordPools.easy);
    else if (currentLevel === 2) pool = pool.concat(wordPools.easy, wordPools.medium);
    else if (currentLevel === 3) pool = pool.concat(wordPools.medium);
    else if (currentLevel === 4) pool = pool.concat(pickRandom(wordPools.medium, 0.5), pickRandom(wordPools.hard, 0.5));
    else if (currentLevel === 5) pool = pool.concat(pickRandom(wordPools.medium, 0.3), pickRandom(wordPools.hard, 0.7));
    else pool = pool.concat(wordPools.hard);
  } else if (wordPools && (wordPools[currentLevel] || wordPools[String(currentLevel)])) {
    const key = wordPools[currentLevel] ? currentLevel : String(currentLevel);
    pool = (wordPools[key] || []).slice();
  } else {
    for (let k in wordPools) {
      if (Array.isArray(wordPools[k])) pool = pool.concat(wordPools[k]);
    }
  }
  let filtered = pool.filter(w => !usedWords.includes(w.english));
  if (filtered.length === 0) {
    let allWords = [];
    for (let k in wordPools) {
      if (Array.isArray(wordPools[k])) allWords = allWords.concat(wordPools[k]);
    }
    filtered = allWords.filter(w => !usedWords.includes(w.english));
  }
  return filtered;
}

function showWord() {
  if (isGameOver) return;
  words = getFilteredWords();
  if (!words || words.length === 0) {
    const bonus = 20;
    feedback.textContent = "üéâ V≈°echna slov√≠ƒçka hotov√°! Z√≠sk√°v√°≈° bonus +" + bonus + " XP!";
    xp += bonus; totalXP += bonus;
    updateDisplays();
    checkLevelUp();
    return;
  }
  shuffle(words);
  currentWord = words[0];
  if (currentWord && currentWord.english) usedWords.push(currentWord.english);
  wordDisplay.textContent = "P≈ôelo≈æ: " + (currentWord ? currentWord.english : "???");
  answerInput.value = "";
  answerInput.focus();
}

/* ==== TRACKING (Mistakes) ==== */
function recordMistake(word) {
  if (!word || !word.id) return;

  fetch("/api/mistake/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-CSRFToken": getCSRFToken(),
    },
    body: JSON.stringify({ word_id: word.id })
  })
  .then(res => res.json())
  .then(data => {
    if (!data.ok) console.warn("‚ùå Chyba p≈ôi odesl√°n√≠ mistake:", data.error);
    else console.log(`üìâ Mistake zaznamen√°n (${word.english}) ‚Üí ${data.incorrect_count}x`);
  })
  .catch(err => console.error("‚ö†Ô∏è Fetch chyba:", err));
}

/* ==== CSRF pomocn√° funkce ==== */
function getCSRFToken() {
  const name = "csrftoken";
  const cookies = document.cookie.split(';');
  for (let c of cookies) {
    const trimmed = c.trim();
    if (trimmed.startsWith(name + "=")) return decodeURIComponent(trimmed.substring(name.length + 1));
  }
  return "";
}

/* ==== ANSWERS & XP ==== */
function submitAnswer() {
  if (isGameOver) return;
  if (!currentWord) { showWord(); return; }
  const userAnswer = answerInput.value.trim().toLowerCase();
  const correctAnswer = (currentWord.czech || "").trim().toLowerCase();

  if (userAnswer === correctAnswer) {
    correctCount++;
    let gainedXP = xpPerCorrect + xpBonus;
    if (adrenalineRush && lives === 1) {
      gainedXP += adrenalineBonus;
      feedback.textContent = `‚úÖ Spr√°vnƒõ! (Adrenaline bonus +${adrenalineBonus} XP)`;
    } else feedback.textContent = "‚úÖ Spr√°vnƒõ!";
    if (doubleXPActive) { gainedXP *= 2; doubleXPActive = false; }
    xp += gainedXP;
    totalXP += gainedXP; 
    if (temporalContract) addTime(3); 
  } else {
    wrongCount++;
    recordMistake(currentWord);
    const damage = glassCannon ? 2 : 1;
    if (temporalContract) addTime(-6); 
    lives -= damage;
    feedback.textContent = "‚ùå ≈†patnƒõ! Spr√°vnƒõ bylo: " + correctAnswer;

    if (lives <= 0 && phoenixFeather && !phoenixUsed) {
      phoenixUsed = true;
      phoenixFeather = false;
      lives = 1; addTime(20);
      feedback.textContent += " üî• Phoenix Feather tƒõ o≈æivila!";
    }

    if (timeWarp && timeWarpReady) {
      timeWarpReady = false;
      freezeTime(2);
      feedback.textContent += " ‚ùÑÔ∏è Time Warp aktivov√°n";
    }
  }

  maybeTriggerMiniEvent();
  updateDisplays();

  if (lives <= 0 && !(!phoenixUsed && phoenixFeather)) {
    gameOver("Do≈°ly ti ≈æivoty!");
    return;
  }

  checkLevelUp();
}

/* ==== TIMER ==== */
function freezeTime(seconds) {
  if (interval) { clearInterval(interval); interval = null; }
  setTimeout(() => { if (!answerInput.disabled && !isGameOver) startTimer(); }, seconds * 1000);
}

function startTimer() {
  if (interval) clearInterval(interval);
  if (isGameOver) return;

  if (timer <= 0) { gameOver("Vypr≈°el ti ƒças!"); return; }

  interval = setInterval(() => {
    timer--;
    clampTimer();
    updateDisplays();
    if (timer <= 0) {
      clearInterval(interval);
      interval = null;
      gameOver("Vypr≈°el ti ƒças!");
    }
  }, 1000);
}

/* ==== MINI EVENTS ==== */
function maybeTriggerMiniEvent() {
  const chance = Math.random();
  if (chance <= 0.12 + miniEventBonus) {
    const events = ["doubleXP", "bonusTime", "heal"];
    const event = events[Math.floor(Math.random() * events.length)];
    handleMiniEvent(event);
  }
}

function handleMiniEvent(event) {
  switch (event) {
    case "doubleXP": doubleXPActive = true; feedback.textContent += " üéÅ DOUBLE XP!"; break;
    case "bonusTime": addTime(5); feedback.textContent += " ‚è≥ +5s"; break;
    case "heal": if (lives < 3) { lives++; feedback.textContent += " üíó +1 ≈æivot"; } break;
  }
}

/* ==== LEVEL PROGRESSION ==== */
function checkLevelUp() {
  if (isGameOver) return;
  const goal = levelXPGoals[currentLevel] || 999999;
  if (xp >= goal) {
    if (currentLevel >= 7) {
      feedback.textContent = "üèÜ Vyhr√°l jsi hru!";
      clearInterval(interval);
      answerInput.disabled = true;
      return;
    }
    openLevelCompleteModal(); 
  } else {
    showWord();
  }
}

/* ==== LEVEL COMPLETE FLOW ==== */
function openLevelCompleteModal() {
  if (interval) { clearInterval(interval); interval = null; }
  answerInput.disabled = true;
  document.getElementById("completeLevelNum").textContent = currentLevel;
  document.getElementById("levelCompleteModal").classList.remove("hidden");
}

function continueToItemSelection() {
  document.getElementById("levelCompleteModal").classList.add("hidden");
  openItemModal(); 
}

/* ==== ITEM MODAL ==== */
const ITEM_DESCRIPTIONS = {
  "Omniscient Reader": "Ka≈æd√° spr√°vn√° odpovƒõƒè +5 XP nav√≠c.",
  "Blessing in Disguise": "Trval√© +10% k ≈°anci na mini event.",
  "Glass Cannon": "Spr√°vn√° odpovƒõƒè +10 XP, ale chyby berou 2 ≈æivoty.",
  "Temporal Contract": "+3s za spr√°vnƒõ, ‚àí6s za ≈°patnƒõ.",
  "Phoenix Feather": "Jedno automatick√© o≈æiven√≠ (+20s) p≈ôi smrti.",
  "Adrenaline Rush": "+3 XP nav√≠c, pokud jsi na posledn√≠m srd√≠ƒçku.",
  "Time Warp": "Prvn√≠ chyba v ka≈æd√©m levelu zmraz√≠ ƒças na 2s."
};

function openItemModal() {
  if (interval) { clearInterval(interval); interval = null; }
  answerInput.disabled = true;

  const allItems = [
    "Omniscient Reader","Blessing in Disguise","Glass Cannon",
    "Temporal Contract","Phoenix Feather","Adrenaline Rush","Time Warp"
  ];
  const available = allItems.filter(i => !pickedItems.includes(i));
  shuffle(available);
  const options = available.slice(0, 2);

  itemGrid.innerHTML = "";
  options.forEach(name => {
    const card = document.createElement("div");
    card.className = "item-card";
    const h4 = document.createElement("h4");
    h4.textContent = name;
    const p = document.createElement("p");
    p.textContent = ITEM_DESCRIPTIONS[name] || "";
    const btn = document.createElement("button");
    btn.textContent = "Vybrat";
    btn.onclick = () => applyItem(name);
    card.appendChild(h4); card.appendChild(p); card.appendChild(btn);
    itemGrid.appendChild(card);
  });

  itemModal.classList.remove("hidden");
}

function applyItem(item) {
  pickedItems.push(item);
  switch (item) {
    case "Omniscient Reader": xpBonus += 5; break;
    case "Blessing in Disguise": miniEventBonus += 0.10; break;
    case "Glass Cannon": glassCannon = true; xpBonus += 10; break;
    case "Temporal Contract": temporalContract = true; break;
    case "Phoenix Feather": phoenixFeather = true; phoenixUsed = false; break;
    case "Adrenaline Rush": adrenalineRush = true; break;
    case "Time Warp": timeWarp = true; timeWarpReady = true; break;
  }

  currentLevel++;
  xp = 0; 
  lives = 3;
  timeWarpReady = timeWarp;
  timer = baseTimes[currentLevel] || timer;
  clampTimer();

  itemModal.classList.add("hidden");
  document.getElementById("nextLevelNum").textContent = currentLevel;
  document.getElementById("nextLevelModal").classList.remove("hidden");
}

/* ==== Start dal≈°√≠ho levelu po Next modal ==== */
function startNextLevel() {
  document.getElementById("nextLevelModal").classList.add("hidden");
  answerInput.disabled = false;
  updateDisplays();
  startTimer();
  showWord();
}

/* ==== UI UPDATES ==== */
function updateLives() {
  if (lives <= 0) livesDisplay.textContent = "üíÄüíÄüíÄ";
  else if (lives === 1) livesDisplay.textContent = "üíóü§çü§ç";
  else if (lives === 2) livesDisplay.textContent = "üíóüíóü§ç";
  else livesDisplay.textContent = "üíóüíóüíó";
}

function updateDisplays() {
  clampTimer();
  xpDisplay.textContent = xp;
  xpTargetDisplay.textContent = levelXPGoals[currentLevel] || xpTargetDisplay.textContent;
  xpGoalSmall.textContent = xpTargetDisplay.textContent;
  levelDisplay.textContent = currentLevel;
  updateLives();

  const goal = (levelXPGoals[currentLevel] || 1);
  let xpPercent = Math.min((xp / goal) * 100, 100);
  xpBar.style.width = xpPercent + "%";

  timerNumber.textContent = timer;
  const base = (baseTimes[currentLevel] || 50);
  const percent = Math.max(0, Math.min(360, (timer / base) * 360));
  timerCircle.style.background = `conic-gradient(var(--accent1) ${percent}deg,var(--accent2) ${percent}deg)`;

  miniChanceDisplay.textContent = Math.round((0.12 + miniEventBonus) * 100) + "%";
}

/* ==== GAME OVER MODAL ==== */
function gameOver(reason = "Konec hry!") {
  if (isGameOver) return;
  isGameOver = true;
  clearInterval(interval);
  interval = null;
  answerInput.disabled = true;

  const titleEl = document.getElementById("gameOverTitle");
  const statsEl = document.getElementById("gameOverStats");
  titleEl.textContent = reason;

  const lastPair = currentWord ? (`<b>${currentWord.english}</b> ‚Üí <b>${currentWord.czech}</b>`) : "???";
  statsEl.innerHTML = `
    Posledn√≠ slovo bylo: ${lastPair}<br>
    Dob≈ôe: <b>${correctCount}</b>, ≈†patnƒõ: <b>${wrongCount}</b><br>
    Z√≠skal jsi: <b>${totalXP} XP</b><br>
    Level: <b>${currentLevel}</b>
  `;

  document.getElementById("gameOverModal").classList.remove("hidden");
}

function restartGame() { location.reload(); }
function closeModal() { document.getElementById("gameOverModal").classList.add("hidden"); }

/* ==== INIT ==== */
updateDisplays();
showWord();
startTimer();
</script>
</body>
</html>
