<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>VocabHero: Hero Mode</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    .heart { font-size: 24px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>ğŸ”¥ HERO MODE ğŸ”¥</h1>

  <p><strong>Level:</strong> <span id="level">1</span></p>
  <p><strong>Å½ivoty:</strong> <span id="lives">â¤ï¸â¤ï¸â¤ï¸</span></p>
  <p><strong>XP:</strong> <span id="xp">0</span> / <span id="xpTarget">100</span></p>
  <p><strong>ÄŒas:</strong> <span id="timer">60</span> s</p>

  <h2 id="wordDisplay">NaÄÃ­tÃ¡nÃ­...</h2>

  <input type="text" id="answerInput" placeholder="Zadej ÄeskÃ½ pÅ™eklad" />
  <button onclick="submitAnswer()">OdpovÄ›dÄ›t</button>

  <p id="feedback"></p>

  <script>
    const wordPools = {{ level_data|safe }};

    let currentLevel = 1;
    let xp = 0;
    const xpPerCorrect = 10;

    const levelXPGoals = {
      1: 110,
      2: 130,
      3: 160,
      4: 190,
      5: 210
    };

    const baseTimes = {
      1: 40,
      2: 45,
      3: 50,
      4: 55,
      5: 60
    };

    let lives = 3;
    let timer = baseTimes[currentLevel];
    let interval = null;
    let currentWord = null;
    let usedWords = []; // ğŸ”¥ NEW
    let words = getFilteredWords(); // ğŸ”¥ NEW
    shuffle(words);

    let activeMiniEvent = null;

    const xpDisplay = document.getElementById("xp");
    const xpTargetDisplay = document.getElementById("xpTarget");
    const levelDisplay = document.getElementById("level");
    const livesDisplay = document.getElementById("lives");
    const timerDisplay = document.getElementById("timer");
    const wordDisplay = document.getElementById("wordDisplay");
    const answerInput = document.getElementById("answerInput");
    const feedback = document.getElementById("feedback");

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function getFilteredWords() {
      return wordPools[currentLevel].filter(w => !usedWords.includes(w.english));
    }

    function showWord() {
      words = getFilteredWords(); // ğŸ”¥ NEW
      if (words.length === 0) {
        feedback.textContent = "ğŸ‰ VÅ¡echna slovÃ­Äka hotovÃ¡! ZÃ­skÃ¡vÃ¡Å¡ bonus XP!";
        xp += 20;
        checkLevelUp();
        return;
      }

      shuffle(words);
      currentWord = words[0];
      wordDisplay.textContent = "PÅ™eloÅ¾: " + currentWord.english;
      answerInput.value = "";
      answerInput.focus();
      maybeTriggerMiniEvent();
    }

    function submitAnswer() {
      const userAnswer = answerInput.value.trim().toLowerCase();
      const correctAnswer = currentWord.czech.trim().toLowerCase();

      usedWords.push(currentWord.english); // ğŸ”¥ NEW

      if (userAnswer === correctAnswer) {
        let gainedXP = xpPerCorrect;
        if (activeMiniEvent === "doubleXP") {
          gainedXP *= 2;
        }
        xp += gainedXP;
        xpDisplay.textContent = xp;
        feedback.textContent = "âœ… SprÃ¡vnÄ›!" + (activeMiniEvent === "doubleXP" ? " (DOUBLE XP!)" : "");
        timer += 2;
        timerDisplay.textContent = timer;
      } else {
        lives--;
        updateLives();
        feedback.textContent = "âŒ Å patnÄ›! SprÃ¡vnÄ› bylo: " + correctAnswer;
      }

      activeMiniEvent = null;

      if (lives <= 0) {
        gameOver();
      } else {
        checkLevelUp();
      }
    }

    function checkLevelUp() {
      const goal = levelXPGoals[currentLevel];

      if (xp >= goal) {
        currentLevel++;

        if (!(currentLevel in wordPools)) {
          feedback.textContent = "ğŸ† VyhrÃ¡l jsi hru! Gratulace!";
          clearInterval(interval);
          answerInput.disabled = true;
          return;
        }

        feedback.textContent = `â¬†ï¸ LEVEL ${currentLevel}!`;
        levelDisplay.textContent = currentLevel;
        xp = 0;
        xpDisplay.textContent = xp;
        xpTargetDisplay.textContent = levelXPGoals[currentLevel];
        lives = 3;
        updateLives();
        timer = baseTimes[currentLevel];
        timerDisplay.textContent = timer;

        words = getFilteredWords(); // ğŸ”¥ NEW
        shuffle(words);

        clearInterval(interval);
        startTimer();
        showWord();
      } else {
        showWord();
      }
    }

    function updateLives() {
      if (lives === 3) livesDisplay.textContent = "â¤ï¸â¤ï¸â¤ï¸";
      else if (lives === 2) livesDisplay.textContent = "â¤ï¸â¤ï¸ğŸ¤";
      else if (lives === 1) livesDisplay.textContent = "â¤ï¸ğŸ¤ğŸ¤";
      else livesDisplay.textContent = "ğŸ’€ğŸ’€ğŸ’€";
    }

    function startTimer() {
      interval = setInterval(() => {
        timer--;
        timerDisplay.textContent = timer;
        if (timer <= 0) {
          clearInterval(interval);
          gameOver();
        }
      }, 1000);
    }

    function gameOver() {
      feedback.textContent = "ğŸ’€ GAME OVER ğŸ’€";
      answerInput.disabled = true;
    }

    function maybeTriggerMiniEvent() {
      const chance = Math.random();
      if (chance <= 0.10) {
        const events = ["doubleXP", "bonusTime", "heal"];
        activeMiniEvent = events[Math.floor(Math.random() * events.length)];
        handleMiniEvent();
      } else {
        activeMiniEvent = null;
      }
    }

    function handleMiniEvent() {
      switch (activeMiniEvent) {
        case "doubleXP":
          feedback.textContent = "ğŸ MINI EVENT: DalÅ¡Ã­ sprÃ¡vnÃ¡ odpovÄ›Ä ti dÃ¡ DOUBLE XP!";
          break;
        case "bonusTime":
          timer += 5;
          timerDisplay.textContent = timer;
          feedback.textContent = "â³ MINI EVENT: BonusovÃ½ch +5 sekund!";
          break;
        case "heal":
          if (lives < 3) {
            lives++;
            updateLives();
            feedback.textContent = "ğŸ’— MINI EVENT: Obnovil se ti jeden Å¾ivot!";
          } else {
            feedback.textContent = "ğŸ’— MINI EVENT: Å½ivot by se obnovil, ale uÅ¾ mÃ¡Å¡ plno!";
          }
          break;
      }
    }

    window.onload = () => {
      xpTargetDisplay.textContent = levelXPGoals[currentLevel];
      levelDisplay.textContent = currentLevel;
      timerDisplay.textContent = timer;
      showWord();
      startTimer();

      answerInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          e.preventDefault();
          submitAnswer();
        }
      });
    };
  </script>
</body>
</html>
