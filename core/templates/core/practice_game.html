<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üå∏ Practice Mode</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg1:#ffeaf5; --bg2:#fbe5ff; --bg3:#e7f7ff; --bg4:#fff0f7;
      --accent1:#ffa3d1; --accent2:#d09eff; --accent3:#f8b8ff;
      --muted:#6b5b7b; --radius:20px;
    }

    body::before {
      content: "";
      position: fixed; inset: 0; z-index: -1;
      background: linear-gradient(-45deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
      background-size: 400% 400%;
      animation: dreamyBG 22s ease infinite;
    }
    @keyframes dreamyBG {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Quicksand', sans-serif;
      color: #4a3b4e;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .wrap {
      width: min(1100px, 95vw);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding-block: 12px;
    }

    .panel {
      flex: 1;
      background: linear-gradient(to bottom right, rgba(255,255,255,0.75), rgba(255,255,255,0.55));
      backdrop-filter: blur(18px) saturate(160%);
      border-radius: var(--radius);
      padding: 36px;
      min-height: 85vh;
      box-shadow: 0 5px 5px rgba(50,40,70,.1);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      animation: fadeIn .8s ease;
      position: relative;
    }
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:none;} }

    .header { display:flex; align-items:center; justify-content:center; margin-bottom: 24px; }
    .header h1 {
      margin: 0;
      font-size: 2rem;
      background: linear-gradient(to right,var(--accent1),var(--accent2));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 6px rgba(0,0,0,.08);
    }

    .progress-bar-container { width: 100%; margin-bottom: 24px; text-align: center; }
    .progress-label { font-size: 1.05rem; color: var(--muted); font-weight: 700; margin-bottom: 8px; }
    .progress-outer {
      width: 100%; height: 24px; background: rgba(0,0,0,.06);
      border-radius: 999px; overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.06);
    }
    .progress-inner {
      height: 100%; width: 0%;
      background: linear-gradient(90deg,var(--accent1),var(--accent2));
      transition: width .5s ease;
    }

    .question-text { font-size: 1.2rem; color: var(--muted); margin: 16px 0 6px; font-weight: 700; text-align:center; }

    .word-box {
      margin-top: 8px;
      border-radius: 18px; padding: 26px; min-height: 110px;
      background: rgba(255,255,255,.85); backdrop-filter: blur(10px);
      text-align: center; font-size: 2rem; font-weight: 700; color:#2b2530;
      box-shadow: 0 8px 18px rgba(0,0,0,.08);
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 28px;
    }

    .answer-container {
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.85));
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 12px 24px rgba(0,0,0,0.08);
      border-radius: 20px;
      padding: 24px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      max-width: 820px;
      width: 100%;
      justify-items: stretch;
      margin: 0 auto 24px;
    }

    .choice-btn {
      padding: 16px 18px;
      background: linear-gradient(90deg,var(--accent1),var(--accent2));
      border: none; border-radius: 16px; color: #fff;
      font-size: 1.15rem; font-weight: 800; cursor: pointer;
      transition: transform .2s ease, filter .2s ease, box-shadow .2s ease;
      box-shadow: 0 6px 16px rgba(0,0,0,.1);
      min-height: 54px;
    }
    .choice-btn:hover { transform: translateY(-2px) scale(1.03); filter: brightness(1.06); }

    .choice-btn.correct { background: #7cd8aa !important; }
    .choice-btn.wrong   { background: #f7839c !important; }

    .back-link {
      display: block;
      margin-top: auto;
      text-align: center;
      text-decoration: none;
      font-weight: 800;
      font-size: 1.05rem;
      color: #c678dd;
      transition: color .2s ease;
    }
    .back-link:hover { color: #a347a0; }

    /* ===== Modal ===== */
    #practiceEndModal {
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.55); z-index:999;
    }
    #practiceEndModal.hidden { display:none; }
    .modal-card {
      width:min(560px,92vw);
      background:linear-gradient(to bottom right,rgba(255,255,255,.95),rgba(255,255,255,.85));
      border-radius:22px; padding:28px; box-shadow:0 12px 32px rgba(0,0,0,.25);
      text-align:center; backdrop-filter:blur(10px);
    }
    .modal-title {
      margin:0 0 6px 0; font-size:1.6rem;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .modal-stats {color:#584a64; font-weight:600; line-height:1.6}
    .modal-actions{margin-top:18px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap}
    .modal-actions button, .modal-actions a{
      border:none; cursor:pointer; font-weight:800; padding:12px 16px; border-radius:14px; text-decoration:none;
      background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#fff; box-shadow:0 6px 16px rgba(0,0,0,.12);
    }
    .modal-actions button:hover, .modal-actions a:hover{filter:brightness(1.08); transform:translateY(-1px)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <div class="header"><h1>üå∏ PRACTICE MODE</h1></div>

      <div class="progress-bar-container">
        <div class="progress-label">Re≈æim: {{ mode_label }}</div>
        <div class="progress-outer">
          <div class="progress-inner" id="progressBar"></div>
        </div>
      </div>

      <div class="question-text">Jak p≈ôelo≈æ√≠≈°:</div>
      <div class="word-box" id="wordBox">Naƒç√≠t√°m...</div>

      <div class="answer-container" id="choicesGrid"></div>

      <a href="{% url 'practice' %}" class="back-link">‚Üê Zpƒõt na v√Ωbƒõr re≈æimu</a>
    </div>
  </div>

  <!-- Modal pro konec -->
  <div id="practiceEndModal" class="hidden">
    <div class="modal-card">
      <h2 class="modal-title">üéâ Hotovo!</h2>
      <div class="modal-stats">
        Spr√°vnƒõ: <b id="correctCount"></b><br>
        ≈†patnƒõ: <b id="wrongCount"></b>
      </div>
      <div class="modal-actions">
        <a href="{% url 'practice_category' %}">Zpƒõt na kategorie</a>
        <button onclick="restartPractice()">Zkusit znovu</button>
      </div>
    </div>
  </div>

<script>
  const words = {{ words|safe }};
  let currentIndex = 0;
  let correctCount = 0;
  let wrongCount = 0;

  const wordBox = document.getElementById("wordBox");
  const choicesGrid = document.getElementById("choicesGrid");
  const progressBar = document.getElementById("progressBar");

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function showWord() {
    if (currentIndex >= words.length) {
      openEndModal();
      return;
    }
    const word = words[currentIndex];
    wordBox.textContent = word.english;

    let options = [word.czech];
    while (options.length < 4) {
      const rand = words[Math.floor(Math.random() * words.length)].czech;
      if (!options.includes(rand)) options.push(rand);
    }
    shuffle(options);

    choicesGrid.innerHTML = "";
    options.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "choice-btn";
      btn.textContent = opt;
      btn.onclick = () => selectAnswer(btn, opt, word.czech);
      choicesGrid.appendChild(btn);
    });

    updateProgress();
  }

  function selectAnswer(btn, selected, correct) {
    const buttons = document.querySelectorAll(".choice-btn");
    buttons.forEach(b => {
      if (b.textContent === correct) b.classList.add("correct");
      else if (b === btn && selected !== correct) b.classList.add("wrong");
      b.disabled = true;
    });
    if (selected === correct) correctCount++;
    else wrongCount++;
    setTimeout(() => { currentIndex++; showWord(); }, 1200);
  }

  function updateProgress() {
    const percent = ((currentIndex) / words.length) * 100;
    progressBar.style.width = percent + "%";
  }

  function openEndModal() {
    document.getElementById("correctCount").textContent = correctCount;
    document.getElementById("wrongCount").textContent = wrongCount;
    document.getElementById("practiceEndModal").classList.remove("hidden");
  }

  function restartPractice() {
    currentIndex = 0;
    correctCount = 0;
    wrongCount = 0;
    document.getElementById("practiceEndModal").classList.add("hidden");
    showWord();
  }

  // Init
  showWord();
</script>
</body>
</html>
